const bookContainer = document.querySelector("#book-container"),
  form = document.querySelector("#book-form"),
  submitButton = document.querySelector("#submit"),
  default_image =
    "https://static.vecteezy.com/system/resources/previews/004/141/669/non_2x/no-photo-or-blank-image-icon-loading-images-or-missing-image-mark-image-not-available-or-image-coming-soon-sign-simple-nature-silhouette-in-frame-isolated-illustration-vector.jpg";
class Book {
  constructor(e, t, o, a, s) {
    (this.id = crypto.randomUUID()),
      (this.title = e),
      (this.author = t),
      (this.pages = o),
      (this.readStatus = a),
      (this.imageUrl = s);
  }
  toggleRead() {
    this.readStatus = !this.readStatus;
  }
  getStatusText() {
    return this.readStatus ? "Complete" : "Unread";
  }
}
class Library {
  static books = [];
  static add(e) {
    this.books.push(e);
  }
  static removeById(e) {
    this.books = this.books.filter((t) => t.id !== e);
  }
  static findById(e) {
    return this.books.find((t) => t.id === e);
  }
  static getAll() {
    return this.books;
  }
}
function displayBooks() {
  (bookContainer.innerHTML = ""),
    Library.getAll().forEach((e) => {
      const t = document.createElement("div"),
        o = document.createElement("img");
      (o.src =
        e.imageUrl && "" !== e.imageUrl.trim() ? e.imageUrl : default_image),
        (o.onerror = () => {
          o.src = default_image;
        }),
        (o.alt = e.title),
        (o.className =
          "object-cover w-full h-40 mb-4 transition-transform duration-300 group-hover:scale-110"),
        t.appendChild(o),
        (t.className =
          "flex flex-col w-full h-full overflow-hidden rounded shadow-custom group bg-base-100"),
        t.classList.add("book"),
        (t.dataset.id = e.id);
      const a = document.createElement("h2");
      (a.className = "mb-2 font-semibold line-clamp-2"),
        (a.textContent = `Title: ${e.title}`);
      const s = document.createElement("span");
      (s.textContent = `Author: ${e.author}`), (s.className = "text-sm");
      const n = document.createElement("span");
      (n.textContent = `Pages: ${e.pages}`), (n.className = "text-sm");
      const i = document.createElement("label");
      i.className = "flex items-center gap-2 text-sm";
      const r = document.createElement("span");
      (r.textContent = `Status: ${e.getStatusText()}`),
        (r.className = "text-sm");
      const d = document.createElement("input");
      (d.type = "checkbox"),
        (d.className = "flex cursor-pointer toggle-read-checkbox");
      const l = document.createElement("div");
      l.className =
        "flex flex-col items-stretch gap-1 p-4 mt-auto card-actions";
      const c = document.createElement("button");
      (c.textContent = "Remove"), (c.className = "btn btn-sm btn-neutral");
      const m = document.createElement("div");
      m.className = "flex flex-col w-full h-full px-4";
      const u = document.createElement("input");
      (u.type = "text"),
        (u.className = "flex-1 border border-gray-300 input"),
        (u.disabled = !0);
      let p = 0;
      c.addEventListener("click", () => {
        p++;
        const o = t.querySelector(".book-id");
        if (((u.placeholder = "Enter book Id"), (u.disabled = !1), !o)) {
          const t = document.createElement("span");
          (t.textContent = `To remove, enter this in the box above: ${e.id}`),
            (t.className = "text-xs text-center book-id"),
            l.appendChild(t);
        }
        if (u.value.trim() === e.id) {
          removeBook(e.id), t.remove();
          const o = new CustomEvent("removeBook", {
            detail: { status: "Book removed," },
          });
          document.dispatchEvent(o);
        }
        p >= 2 &&
          (u.classList.remove("border-gray-300"),
          u.classList.add("border-red-500"));
      }),
        l.appendChild(u),
        l.appendChild(c),
        m.appendChild(a),
        m.appendChild(s),
        m.appendChild(n),
        i.appendChild(d),
        i.appendChild(r),
        m.appendChild(i),
        t.appendChild(m),
        t.appendChild(l),
        bookContainer.appendChild(t),
        d.addEventListener("change", () => {
          const t = Library.findById(e.id);
          t.toggleRead(), (r.textContent = `Status: ${t.getStatusText()}`);
        });
    });
}
function removeBook(e) {
  Library.removeById(e), console.table(Library.getAll());
}
Library.add(
  new Book(
    "Solo Leveling",
    "Chugong",
    "312 - volume 1",
    !0,
    "https://m.media-amazon.com/images/S/pv-target-images/a90c37cc3e0bcddcb2cc8d068664c874585e8dc3fbaeae08a742b26ad243f047.jpg"
  )
),
  Library.add(
    new Book(
      "Demon Slayer: Kimetsu no Yaiba",
      "Koyoharu Gotouge",
      "4500+",
      !0,
      "https://cdn.theouterhaven.net/wp-content/uploads/2024/06/demon-slayer-infinity-castle-trilogy-768x403.jpg"
    )
  ),
  Library.add(
    new Book(
      "Sakamoto Days",
      "Yuto Suzuki",
      "200 - #1",
      !0,
      "https://static0.cbrimages.com/wordpress/wp-content/uploads/2022/04/sakamoto-days-key-visual.jpg"
    )
  ),
  Library.add(
    new Book(
      "Jujutsu kaisen",
      "Gege Akutami",
      "5700 to 6000+",
      !1,
      "https://static0.cbrimages.com/wordpress/wp-content/uploads/2024/11/jjk-s-shibuya-incident.jpg?w=1600&h=900&fit=crop"
    )
  ),
  Library.add(
    new Book(
      "My Hero Academia",
      "KÅhei Horikosh",
      "7500 to 8400+",
      !1,
      "https://miro.medium.com/v2/1*W2heFUeeOS_5lWZDBe7hpA.jpeg"
    )
  ),
  Library.add(
    new Book(
      "One Piece",
      "Eiichiro Oda",
      "22000+",
      !1,
      "https://image.tmdb.org/t/p/original/mBxsapX4DNhH1XkOlLp15He5sxL.jpg"
    )
  ),
  Library.add(
    new Book(
      "Hell University, part 1",
      "KnightinBlack",
      256,
      !0,
      "https://share-media.literal.club/media/book/knightinblack-hell-university-part-1-yj48w?format=landscape"
    )
  ),
  Library.add(
    new Book(
      "My Husband is a Mafia Boss Season 1",
      "Yanalovesyouu",
      736,
      !1,
      "https://pbs.twimg.com/media/FRrAlBNagAYwivR.jpg"
    )
  ),
  console.table(Library.getAll()),
  displayBooks(),
  document.addEventListener("removeBook", (e) => {
    console.log(`Library: ${e.detail.status}`);
  }),
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const t = document.querySelector("#title"),
      o = document.querySelector("#author"),
      a = document.querySelector("#pages"),
      s = document.querySelector("#book-image");
    Library.add(new Book(t.value, o.value, a.value, !1, s.value)),
      displayBooks(),
      (t.value = ""),
      (o.value = ""),
      (a.value = ""),
      (s.value = "");
    const n = new CustomEvent("submitForm", {
      detail: { status: "Form submitted, new book added!" },
    });
    document.dispatchEvent(n);
  }),
  document.addEventListener("submitForm", (e) => {
    console.log(`Library: ${e.detail.status}`);
  });
